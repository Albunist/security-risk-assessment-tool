<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api/xml-json/alter-isra/alter-risks.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api/xml-json/alter-isra/alter-risks.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*----------------------------------------------------------------------------
*
*     Copyright Â© 2022 THALES. All Rights Reserved.
 *
* -----------------------------------------------------------------------------
* THALES MAKES NO REPRESENTATIONS OR WARRANTIES ABOUT THE SUITABILITY OF
* THE SOFTWARE, EITHER EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED
 * TO THE IMPLIED WARRANTIES OF MERCHANTABILITY, FITNESS FOR A
 * PARTICULAR PURPOSE, OR NON-INFRINGEMENT. THALES SHALL NOT BE
 * LIABLE FOR ANY DAMAGES SUFFERED BY LICENSEE AS A RESULT OF USING,
 * MODIFYING OR DISTRIBUTING THIS SOFTWARE OR ITS DERIVATIVES.
*
* THIS SOFTWARE IS NOT DESIGNED OR INTENDED FOR USE OR RESALE AS ON-LINE
* CONTROL EQUIPMENT IN HAZARDOUS ENVIRONMENTS REQUIRING FAIL-SAFE
* PERFORMANCE, SUCH AS IN THE OPERATION OF NUCLEAR FACILITIES, AIRCRAFT
* NAVIGATION OR COMMUNICATION SYSTEMS, AIR TRAFFIC CONTROL, DIRECT LIFE
* SUPPORT MACHINES, OR WEAPONS SYSTEMS, IN WHICH THE FAILURE OF THE
* SOFTWARE COULD LEAD DIRECTLY TO DEATH, PERSONAL INJURY, OR SEVERE
* PHYSICAL OR ENVIRONMENTAL DAMAGE ("HIGH RISK ACTIVITIES"). THALES
* SPECIFICALLY DISCLAIMS ANY EXPRESS OR IMPLIED WARRANTY OF FITNESS FOR
* HIGH RISK ACTIVITIES.
* -----------------------------------------------------------------------------
*/

const { counter } = require('../../../utility-global');
const { getHTMLString } = require('../utility');

/** modify parsed ISRA JSON to fit schema
       * @function alterRisks
       * @param {object} risks - risks JSON that has been parsed
       * @param {string} xmlDAta - content of xml file
       * @returns {object} edited risks JSON data
       * */
const alterRisks = (xmlData, risks) => ((xmlDataCopy, risksCopy) => {
  if (Array.isArray(risksCopy)) {
    const riskCounter = counter();
    const riskMitigationCounter = counter();

    risksCopy.forEach((risk) => {
      riskCounter.increment();
      const r = risk;
      const {
        riskId,
        projectName,
        projectVersion,
        ImpactRiskEvaluation,
        LikelihoodRiskEvaluation,
        VulnerabilityRiskEvaluation,
        riskName,
        threatAgent,
        threatVerb,
        motivation,
        businessAssetRef,
        supportingAssetRef,
        Mitigation,
        mitigationsBenefits,
        mitigationsDoneBenefits,
      } = r;

      const { riskLikelihood } = LikelihoodRiskEvaluation[0];
      const { riskImpact, BusinessAssetSelectedProperties } = ImpactRiskEvaluation[0];

      r.projectNameRef = projectName;
      r.projectVersionRef = projectVersion;
      r.riskManagementDetail = getHTMLString(xmlDataCopy, 'riskManagmentDetail', riskCounter.getCount());

      // alter risk name
      r.riskName = {
        riskIdRef: riskId,
        riskName,
        threatAgent,
        threatAgentDetail: getHTMLString(xmlDataCopy, 'threatAgentDetail', riskCounter.getCount()),
        threatVerb,
        threatVerbDetail: getHTMLString(xmlDataCopy, 'threatVerbDetail', riskCounter.getCount()),
        motivation,
        motivationDetail: getHTMLString(xmlDataCopy, 'motivationDetail', riskCounter.getCount()),
        businessAssetRef,
        supportingAssetRef,
      };

      // alter risk likelihood
      if ('OWASPLikelihoodEvaluation' in LikelihoodRiskEvaluation[0].LikelihoodRiskEvaluationMethod[0]) {
        const likelihoodEvaluation = r
          .LikelihoodRiskEvaluation[0]
          .LikelihoodRiskEvaluationMethod[0]
          .OWASPLikelihoodEvaluation[0];
        delete likelihoodEvaluation.OWASPLikelihoodScore;
        const { ThreatFactor, ...rest } = likelihoodEvaluation;

        r.riskLikelihood = {
          riskIdRef: riskId,
          riskLikelihood,
          riskLikelihoodDetail: getHTMLString(xmlDataCopy, 'riskLikelihoodDetail', riskCounter.getCount()),
          ...ThreatFactor[0],
          ...rest,
        };
      } else {
        r.riskLikelihood = {
          riskIdRef: riskId,
          riskLikelihood,
          riskLikelihoodDetail: getHTMLString(xmlDataCopy, 'riskLikelihoodDetail', riskCounter.getCount()),
        };
      }

      // alter risk impact
      r.riskImpact = {
        riskIdRef: riskId,
        riskImpact,
        businessAssetPropertiesRef: businessAssetRef,
        ...BusinessAssetSelectedProperties[0],
      };

      // alter risk attack path
      if (VulnerabilityRiskEvaluation !== undefined) {
        const riskAttackPathIdCounter = counter();
        r.riskAttackPaths = VulnerabilityRiskEvaluation.map((attackPath) => {
          const { vulnerabilityRef, attackPathName, attackPathScore } = attackPath;
          riskAttackPathIdCounter.increment();
          const riskAttackPathId = riskAttackPathIdCounter.getCount();

          const vulnerabilityRefs = vulnerabilityRef.map((v) => {
            const obj = {};
            obj.vulnerabilityIdRef = v.char !== undefined ? v.char : '';
            obj.score = v.$.score;
            obj.name = v.$.name;
            return obj;
          });

          const newAttackPath = {
            riskIdRef: riskId,
            riskAttackPathId,
            attackPathName,
            attackPathScore,
            vulnerabilityRef: vulnerabilityRefs,
          };
          return newAttackPath;
        });
      } else r.riskAttackPaths = [];

      // alter risk mitigation
      if (Mitigation !== undefined) {
        const riskMitigationIdCounter = counter();
        r.riskMitigation = Mitigation.map((rm) => {
          riskMitigationCounter.increment();
          riskMitigationIdCounter.increment();
          const riskMitigationId = riskMitigationIdCounter.getCount();
          const {
            mitigationDecision, description, ...mitigation
          } = rm;

          const obj = {
            riskIdRef: riskId,
            riskMitigationId,
            description: getHTMLString(xmlDataCopy, 'description', riskMitigationCounter.getCount()),
            decisionDetail: getHTMLString(xmlDataCopy, 'decisionDetail', riskMitigationCounter.getCount()),
            decision: mitigationDecision[0].decision,
            ...mitigation,
            mitigationsBenefits,
            mitigationsDoneBenefits,
          };
          return obj;
        });
      } else r.riskMitigation = [];
    });
  }
  return risksCopy;
})(xmlData, risks);

module.exports = alterRisks;
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="BusinessAsset.html">BusinessAsset</a></li><li><a href="BusinessAssetProperties.html">BusinessAssetProperties</a></li><li><a href="ISRAMetaTracking.html">ISRAMetaTracking</a></li><li><a href="ISRAProject.html">ISRAProject</a></li><li><a href="ISRAProjectContext.html">ISRAProjectContext</a></li><li><a href="Risk.html">Risk</a></li><li><a href="RiskAttackPath.html">RiskAttackPath</a></li><li><a href="RiskImpact.html">RiskImpact</a></li><li><a href="RiskLikelihood.html">RiskLikelihood</a></li><li><a href="RiskMitigation.html">RiskMitigation</a></li><li><a href="RiskName.html">RiskName</a></li><li><a href="SupportingAsset.html">SupportingAsset</a></li><li><a href="Vulnerability.html">Vulnerability</a></li></ul><h3>Global</h3><ul><li><a href="global.html#alterBusinessAssets">alterBusinessAssets</a></li><li><a href="global.html#alterISRA">alterISRA</a></li><li><a href="global.html#alterISRAmeta">alterISRAmeta</a></li><li><a href="global.html#alterProjectContext">alterProjectContext</a></li><li><a href="global.html#alterRisks">alterRisks</a></li><li><a href="global.html#alterSupportingAssets">alterSupportingAssets</a></li><li><a href="global.html#alterVulnerability">alterVulnerability</a></li><li><a href="global.html#editName">editName</a></li><li><a href="global.html#parser">parser</a></li><li><a href="global.html#parseString">parseString</a></li><li><a href="global.html#populateClass">populateClass</a></li><li><a href="global.html#removeNameSpacePreifx">removeNameSpacePreifx</a></li><li><a href="global.html#removeNaN">removeNaN</a></li><li><a href="global.html#validateJsonSchema">validateJsonSchema</a></li><li><a href="global.html#XML2JSON">XML2JSON</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Thu Apr 21 2022 13:08:00 GMT+0800 (Singapore Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
